function [BW,maskedImage] = segmentImage(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter app
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter app. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 24-Apr-2022
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph cut
foregroundInd = [1209531 1209537 1209542 1209545 1209548 1209551 1209556 1209562 1214114 1214120 1214123 1214125 1214131 1214134 1214137 1217247 1217250 1217256 1217258 1217261 1217267 1217269 1217272 1217275 1217281 1217283 1217286 1217292 1217294 1217300 1217305 1217311 1217314 1217316 1217319 1217325 1217328 1217330 1217336 1217339 1217347 1217350 1217355 1221781 1221783 1221786 1221789 1221792 1221966 1226380 1226383 1226386 1226574 1226582 1226588 1226591 1226596 1226599 1230985 1231207 1231210 1231212 1231218 1231221 1234038 1234044 1234049 1234055 1234060 1234293 1238646 1238904 1238909 1238912 1243251 1243525 1247857 1248133 1248136 1252752 1255534 1255537 1255827 1260435 1260441 1260443 1260446 1264744 1265057 1269347 1269668 1269671 1269676 1269682 1277367 1281621 1281626 1281978 1281983 1281989 1286215 1286218 1289672 1289675 1293890 1294285 1298893 1298899 1298902 1303094 1303097 1303100 1303512 1303518 1307700 1307702 1308129 1310769 1311201 1311206 1311212 1311215 1311217 1315371 1315374 1315828 1320436 1320439 1324579 1324585 1327651 1328122 1328127 1332256 1336853 1336859 1336862 1337346 1344533 1345029 1345031 1349141 1349639 1349642 1353746 1354253 1358349 1358864 1366023 1366026 1366544 1371154 1375231 1375234 1375237 1380373 1387516 1388059 1396732 1397275 1400347 1404410 1404412 1409015 1409568 1413620 1416692 1417251 1421300 1425908 1426467 1430511 1431078 1435116 1435119 1435689 1438185 1438761 1442793 1447401 1447977 1452585 1455081 1464291 1464878 1468899 1469486 1471969 1477166 1481182 1481774 1485787 1486385 1490993 1493462 1494065 1498070 1498673 1502678 1503281 1507283 1507892 1507894 1514957 1515574 1520182 1524173 1524790 1527245 1527862 1531853 1532470 1536461 1537084 1541067 1545672 1546300 1553349 1553352 1553980 1557954 1562562 1563196 1565634 1566268 1574850 1575484 1582530 1583164 1587138 1587772 1591746 1592380 1596354 1596988 1604034 1609276 1613250 1613884 1617858 1618492 1621564 1625538 1626172 1630780 1634754 1635388 1637826 1642437 1643068 1651653 1651656 1652284 1654731 1659341 1659964 1664572 1673171 1676246 1676248 1676860 1690684 1693150 1698364 1702369 1702972 1706977 1707580 1710652 1719267 1719868 1723878 1724476 1729081 1736172 1736761 1740783 1741369 1748465 1749049 1753076 1758265 1762292 1762295 1762873 1765367 1765945 1770553 1774588 1775161 1779764 1779766 1782271 1786882 1786885 1786887 1786893 1787444 1791501 1791504 1792052 1796114 1796660 1800725 1800728 1803803 1804340 1808414 1808948 1813024 1813027 1818164 1820715 1825326 1825844 1834545 1835054 1837617 1842233 1842734 1846844 1851458 1856066 1856558 1859146 1859151 1859160 1859171 1859176 1863787 1864238 1873011 1873020 1873454 1880705 1880713 1880722 1881134 1885739 1889946 1889952 1893032 1893419 1897651 1902267 1902273 1902635 1906881 1911494 1911503 1911851 1914577 1914923 1919188 1919194 1923807 1923810 1924134 1928739 1931496 1931501 1931504 1931808 1940723 1940725 1941024 1945336 1945339 1945342 1945345 1945347 1945632 1953036 1953038 1953044 1953047 1953052 1953304 1953307 1953312 1957663 1957909 1962274 1962279 1962514 1966887 1967120 1969962 1969968 1969973 1970189 1974587 1974589 1974595 1974791 1974794 1974797 1979206 1979394 1979397 1983816 1983822 1983825 1984002 1986902 1987068 1991516 1991519 1991668 1991674 1996273 1996276 2000743 2000751 2000757 2000762 2003837 2003843 2003848 2003851 2003854 2003859 2003942 2003945 2003948 2003951 2008467 2008514 2008517 2008520 2008525 2008531 2008534 2008536 2008539 2008545 2008550 2013078 2013081 2013089 2013095 2013097 2013100 2013103 2013108 2013114 2013119 ];
backgroundInd = [230598 230604 230609 230618 230623 230629 230640 230648 230657 230668 230684 230698 230717 230728 230745 230762 230784 230800 230817 230831 230847 230861 230870 230883 230886 230892 230900 230906 230914 230917 230928 230936 230942 230950 230955 230969 230980 230986 230994 231321 235613 235627 235644 235663 235898 235904 235915 240293 240310 240335 240351 240373 240398 240423 240440 240454 240468 240481 240498 312161 312178 312192 312211 312222 312233 312247 316750 316761 319952 324427 329024 329190 329223 329295 338226 338232 345892 355092 362766 371977 384262 388862 401139 418029 427237 439517 451796 468689 477892 485566 490174 499382 502451 576586 576597 576611 576622 576636 576647 576655 576666 576674 576677 576691 576697 576705 576710 576716 576721 576724 584180 584197 584208 584224 584238 584252 588758 588766 588774 596427 601023 605612 605620 613275 613284 617872 622472 627072 630141 634691 634738 639299 643940 643943 648512 648518 648520 648526 648532 648540 959282 959302 959310 962388 962399 971628 971833 976250 976441 979333 984124 993174 993185 993343 1000879 1001023 1010109 1010239 1014850 1022411 1022530 1031643 1031746 1034544 1034823 1039149 1039337 1048365 1048567 1051650 1056045 1056327 1060874 1065258 1065493 1065543 1069863 1070110 1073190 1073223 1077186 1077543 1077806 1081786 1081789 1081791 1086391 1086759 1087030 1089452 1089458 1090105 1090125 1094057 1094439 1094719 1098660 1099047 1103946 1106323 1106334 1106727 1107018 1107021 1111629 1111631 1115946 1120133 1120560 1120847 1120856 1125170 1125469 1127802 1128530 1128541 1132856 1137010 1137472 1137483 1137746 1137760 1137766 1137768 1141607 1142379 1142382 1145166 1145174 1145183 1149281 1149796 1150034 1154277 1154412 1154424 1154426 1158863 1158871 1158882 1159250 1161561 1162112 1162117 1162123 1162126 1162131 1162134 1162139 1166496 1166512 1166526 1166750 1166753 1166756 1166759 1166761 1166764 1166767 1166770 1166775 1166778 1166783 1166933 1171394 1175374 1176005 1180511 1180613 1180757 1183364 1183372 1183375 1183585 1183691 1183693 1183696 1183699 1183704 1183829 1187654 1187955 1188196 1188202 1188207 1188312 1188318 1188321 1188323 1188326 1196853 1197155 1197163 1197432 1197437 1197440 1197545 1197548 1197553 1197556 1197559 1197562 1197564 1197567 1197570 1197573 1197575 1200221 1200517 1200523 1200528 1200534 1200650 1200725 1204522 1204810 1204813 1204818 1204826 1205261 1205264 1209410 1209412 1209415 1209753 1209758 1209941 1213730 1214018 1214482 1214488 1216791 1217090 1217447 1217560 1217563 1221692 1222060 1222066 1222071 1222074 1222077 1222174 1225998 1226297 1226687 1226837 1230902 1233670 1233969 1233972 1238566 1238569 1238574 1239130 1242858 1242861 1242878 1243102 1247710 1247774 1247776 1252318 1255390 1255451 1256026 1259998 1260053 1260535 1264603 1265143 1269751 1269850 1272283 1276888 1276935 1276941 1277431 1277436 1277439 1277530 1281494 1286102 1286663 1286672 1289212 1289749 1293782 1293818 1294360 1294366 1294371 1294429 1298387 1298985 1303028 1303595 1303601 1303606 1303609 1303645 1307600 1307631 1307633 1310672 1315277 1315280 1315933 1319885 1319919 1324493 1324521 1325149 1327563 1327593 1332168 1332195 1332198 1332829 1336773 1336803 1341411 1342045 1344450 1344481 1345117 1349086 1349861 1353666 1353691 1354333 1358299 1362882 1363549 1365976 1366757 1370557 1370582 1371229 1375190 1375973 1379798 1380445 1382845 1383517 1387453 1387472 1388261 1392058 1392733 1396688 1397341 1397477 1399738 1399757 1400413 1404343 1405154 1408973 1409629 1413556 1414237 1416648 1417442 1421231 1421917 1422050 1425836 1425864 1426658 1430472 1431133 1435049 1435077 1435874 1438146 1438813 1442727 1442754 1447359 1447362 1448029 1448162 1452637 1455037 1459617 1459645 1460317 1464253 1465058 1468833 1469533 1471902 1471930 1476535 1476538 1481113 1481140 1481821 1485718 1485746 1486562 1490323 1490351 1491037 1493423 1498031 1502606 1502608 1503458 1507211 1507244 1507247 1507933 1510316 1511138 1514888 1514924 1519532 1520221 1524101 1524962 1527173 1527212 1531781 1531815 1536420 1536423 1537117 1541025 1541858 1548705 1549405 1554146 1557921 1562529 1565601 1571042 1574817 1575517 1579425 1582497 1591660 1591710 1592546 1596268 1596315 1597021 1597154 1599340 1603948 1603993 1603995 1608556 1608562 1608601 1609442 1617817 1618525 1620853 1620889 1625497 1626338 1630072 1634713 1637785 1638626 1643101 1646973 1647001 1647842 1651506 1651509 1651512 1651609 1654681 1659186 1659289 1659992 1660130 1663794 1663875 1663897 1668400 1668505 1673118 1676168 1676190 1677026 1680685 1685412 1689901 1690850 1693070 1693784 1697700 1702189 1702311 1703138 1706896 1706921 1709869 1709993 1709996 1710674 1714604 1719085 1719193 1720031 1723820 1728301 1728411 1728434 1729106 1729247 1731370 1731508 1736097 1736119 1740586 1740727 1740730 1740735 1745316 1745343 1746138 1748266 1753001 1753029 1753682 1757482 1757609 1757637 1758426 1762220 1762248 1762251 1762253 1765298 1765325 1769770 1769906 1769936 1769939 1774547 1774550 1775316 1778986 1779127 1779160 1782202 1782232 1782991 1786666 1786840 1787474 1791429 1791435 1791448 1796045 1796059 1800496 1801298 1801420 1803742 1803745 1808339 1808342 1812786 1817394 1817400 1817560 1818310 1820372 1824980 1825083 1825246 1825874 1829588 1829699 1829859 1834310 1835204 1837263 1837384 1837542 1846479 1846600 1846603 1846609 1846767 1847483 1851986 1855689 1855830 1855985 1855988 1856594 1858761 1858905 1859063 1859766 1863519 1863674 1863676 1867977 1868284 1872740 1872895 1872901 1872903 1873490 1873590 1875657 1875820 1875986 1880442 1881270 1884870 1884873 1889476 1890386 1892739 1893555 1897156 1902674 1902771 1906576 1910977 1911190 1915059 1918657 1923486 1924178 1931858 1931955 1935553 1935791 1945010 1945773 1952449 1957311 1958059 1966273 1966539 1970344 1974224 1979557 1983169 1986523 1987232 1991840 2000361 2001056 2008049 2012353 2012666 2013338 2020354 2025488 2025626 2029249 2029578 2030090 2030096 2034192 2034693 2039290 2039295 2039445 2041537 2041877 2046967 2051102 2051107 2051569 2051575 2051730 2055721 2059238 2059244 2059410 2063401 2063403 2063843 2067649 2068424 2068429 2068435 2068440 2068446 2068620 2072625 2072630 2076093 2076095 2080313 2080319 2080324 2080690 2080695 2084548 2084935 2084938 2084941 2084943 2084946 2085292 2085511 2089886 2089895 2093764 2094173 2094179 2094187 2094195 2094204 2094724 2097519 2097547 2097555 2097561 2097790 2101892 2101897 2101906 2101917 2101922 2101928 2101933 2101942 2101947 2101950 2101956 2101961 2101967 2101975 2101978 2101981 2101986 2102127 2102133 2102141 2102147 2106054 2111208 2111210 2111213 2111216 2111612 2113734 2127561 2128499 2135244 2140782 2152140 2153067 2161356 2166886 2169952 2173644 2178495 2182860 2183103 2183765 2183770 2186178 2186184 2186187 2190545 2190800 2190806 2190811 2196047 2199761 2200041 2200653 2202833 2203716 2203722 2207729 2212343 2212932 2216965 2217540 2221268 2221584 2222146 2224346 2225206 2225212 2225215 2228957 2229269 2229280 2229814 2233573 2234403 2234409 2234414 2234417 2238507 2238510 2242075 2246201 2246204 2246212 2246666 2246674 2250469 2250829 2250831 2250837 2250842 2250848 2255080 2255459 2255868 2255874 2258536 2258542 2258929 2263529 2267766 2267772 2267777 2267785 2267791 2267797 2271984 2272416 2272421 2272429 2272435 2272446 2272457 2272474 2272485 2272499 2272513 2272532 2272546 2272562 2272573 2272590 2272601 2272618 2272637 2272651 2272665 2272681 2272695 2272709 2272720 2272726 2272734 2288888 2305793 2322700 2334993 2348825 2368802 2378023 2394930 2411832 2421056 2437960 2445649 2454870 2467164 2471777 2476391 2476396 2476399 2476405 2479480 2484090 2488704 2493320 2496395 2505619 2505622 2505633 2517932 2522543 2527159 2534839 2534842 2534847 2534850 2544072 2544075 2544077 ];
L = superpixels(X,15829,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1) = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2) = (in(:,:,2) + 86.1827) / 184.4170;  % a* range is [-86.1827,98.2343].
out(:,:,3) = (in(:,:,3) + 107.8602) / 202.3382;  % b* range is [-107.8602,94.4780].

end
